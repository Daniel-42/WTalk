<Window x:Class="Wtalk.Desktop.ConversationWindow"
        xmlns:local="clr-namespace:Wtalk.Desktop.Converter"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:system="clr-namespace:System;assembly=mscorlib"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:dt="clr-namespace:Wtalk.Desktop.CustomDataTemplate"
        mc:Ignorable="d"
        xmlns:designData="clr-namespace:Wtalk.Desktop.DesignData"
        d:DataContext="{d:DesignInstance Type=designData:DesignConversationViewModel, IsDesignTimeCreatable=True}"
        Title="{Binding Participants, Mode=OneWay, StringFormat='Wtalk - {0}'}" Height="350" Width="300" Style="{DynamicResource window_style}" x:Name="conversation_window">
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Resources\WTalkStyle.xaml" />
                <ResourceDictionary Source="Resources\MessageDataTemplate.xaml" />
                <ResourceDictionary>
                    <local:TextAlignmentConverter x:Key="textAlignmentConverter" />
                    <!--<system:String x:Key="me"></system:String>-->
                </ResourceDictionary>
            </ResourceDictionary.MergedDictionaries>            
        </ResourceDictionary>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="25"></RowDefinition>
            <RowDefinition Height="*"></RowDefinition>
            <RowDefinition Height="Auto"></RowDefinition>
        </Grid.RowDefinitions>

        <!--
    <ScrollViewer x:Name="scrollBar" Padding="0,5,0,0" Margin="0,0,0,22">    
        <StackPanel>                        
                    <ItemsControl ItemsSource="{Binding Messages}">
                        <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <StackPanel>
                            <Border BorderThickness="1" BorderBrush="Gainsboro" CornerRadius="3" Padding="5" Margin="2" Background="#f8f8f8">                                
                                <TextBox Text="{Binding Content, Mode=OneWay}" TextWrapping="Wrap" Tag="{Binding SenderId}" BorderThickness="0" Background="Transparent" IsReadOnly="True">
                                    <TextBox.TextAlignment>
                                        <MultiBinding Converter="{StaticResource textAlignmentConverter}">
                                            <Binding RelativeSource="{RelativeSource Self}"/>
                                            <Binding ElementName="conversation_window" Path="DataContext.Participant.Id"/>
                                        </MultiBinding> 
                                    </TextBox.TextAlignment>                                    
                                </TextBox>
                                </Border>
                                <TextBlock Foreground="Gray" FontStyle="Italic" FontSize="10" Text="{Binding MessageDate, StringFormat={}{0:dd/MM HH:mm} }" Padding="5,0"/>
                            </StackPanel>
                        </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>                        
                    </StackPanel>
        </ScrollViewer>
        -->
        <StackPanel Grid.Row="0" Orientation="Horizontal">
            <ToggleButton Style="{StaticResource toggle_button}"  Height="20" Width="20" BorderThickness="0" IsChecked="{Binding HistoryEnabled,Mode=OneWay}" Command="{Binding SetOTRCommand}"  Margin="5,0">
                <Path Stretch="Fill" Fill="{Binding Path=Foreground, RelativeSource={RelativeSource AncestorType=ToggleButton}}" Data="F1 M 53.8333,41.1667C 53.8333,49.9112 46.7445,57 38,57C 29.2555,57 22.1667,49.9112 22.1667,41.1667C 22.1667,32.9565 28.4156,26.2059 36.4167,25.4115L 36.4167,23.75L 31.6667,23.75L 31.6667,19L 44.3333,19L 44.3333,23.75L 39.5833,23.75L 39.5833,25.4115C 42.7678,25.7277 45.6747,26.9874 48.0205,28.907L 49.1629,27.7646L 46.9237,25.5254L 50.2825,22.1667L 57,28.8842L 53.6412,32.2429L 51.4021,30.0038L 50.2597,31.1462C 52.4933,33.8756 53.8333,37.3647 53.8333,41.1667 Z M 26.2296,39.5834L 30.0833,39.5834L 30.0833,42.75L 26.2296,42.75C 26.9347,48.0419 31.1248,52.232 36.4166,52.9371L 36.4166,49.0833L 39.5833,49.0833L 39.5833,52.937C 44.8752,52.232 49.0653,48.0419 49.7703,42.75L 45.9166,42.75L 45.9166,39.5834L 49.7703,39.5834C 49.0652,34.2915 44.8751,30.1014 39.5833,29.3964L 39.5833,33.25L 36.4166,33.25L 36.4166,29.3963C 31.1248,30.1014 26.9347,34.2915 26.2296,39.5834 Z M 38,38C 39.7489,38 41.1666,39.4178 41.1666,41.1667C 41.1666,42.9156 39.7489,44.3334 38,44.3334L 31.6666,49.0834L 34.8333,41.1667C 34.8333,39.4178 36.2511,38 38,38 Z "/>
            </ToggleButton>
            <Button Foreground="Gray"  Height="20" Width="20" Background="Transparent" BorderThickness="0" Padding="2,1"  Margin="5,0" Command="{Binding DeleteConversationCommand}">
                <Path Stretch="Fill" Fill="{Binding Path=Foreground, RelativeSource={RelativeSource AncestorType=Button}}" Data="F1 M 25.3333,23.75L 50.6667,23.75C 51.5411,23.75 51.8541,27.3125 51.8541,27.3125L 24.1458,27.3125C 24.1458,27.3125 24.4589,23.75 25.3333,23.75 Z M 35.625,19.7917L 40.375,19.7917C 40.8122,19.7917 41.9583,20.9378 41.9583,21.375C 41.9583,21.8122 40.8122,22.9584 40.375,22.9584L 35.625,22.9584C 35.1878,22.9584 34.0416,21.8122 34.0416,21.375C 34.0416,20.9378 35.1878,19.7917 35.625,19.7917 Z M 27.7083,28.5L 48.2916,28.5C 49.1661,28.5 49.875,29.2089 49.875,30.0834L 48.2916,53.8334C 48.2916,54.7078 47.5828,55.4167 46.7083,55.4167L 29.2917,55.4167C 28.4172,55.4167 27.7083,54.7078 27.7083,53.8334L 26.125,30.0834C 26.125,29.2089 26.8339,28.5 27.7083,28.5 Z M 30.0833,31.6667L 30.4792,52.25L 33.25,52.25L 32.8542,31.6667L 30.0833,31.6667 Z M 36.4167,31.6667L 36.4167,52.25L 39.5833,52.25L 39.5833,31.6667L 36.4167,31.6667 Z M 43.1458,31.6667L 42.75,52.25L 45.5208,52.25L 45.9167,31.6667L 43.1458,31.6667 Z "/>
            </Button>
        </StackPanel>
        <Rectangle Grid.Row="0" Fill="#FFABADB3" Height="1" VerticalAlignment="Bottom"/>
        <ScrollViewer x:Name="scrollBar" Padding="2,5,2,0" Grid.Row="1">
            <StackPanel>
                <ItemsControl ItemsSource="{Binding Messages}">
                    <ItemsControl.ItemTemplateSelector>
                        <dt:MessageDataTemplateSelector In="{StaticResource IncommingMessage}" Out="{StaticResource OutgoingMessage}"  />
                    </ItemsControl.ItemTemplateSelector>                    
                </ItemsControl>
            </StackPanel>
        </ScrollViewer>
        <TextBox Grid.Row="2" Padding="2" VerticalAlignment="Bottom" TextWrapping="Wrap" BorderThickness="0,1,0,0" x:Name="message_textbox" AcceptsReturn="True" Margin="0,0,20,0"/>
        </Grid>      
</Window>
